<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="initial-scale=3, user-scalable=no">
  <title>Nintendo DS Touch Output</title>
  <script src="//code.jquery.com/jquery-git2.js"></script>
  <script src="/socket.io/socket.io.js"></script>
  <style type="text/css">
  canvas {
    border: 1px solid black;
  }
  </style>
</head>
<body>
  <canvas width="800" height="600"></canvas>
  <div>
    <button id="clear">Clear</button>
  </div>
  <output></output>

  <script>
  function scale(value, fromLow, fromHigh, toLow, toHigh) {
    return (value - fromLow) * (toHigh - toLow) /
      (fromHigh - fromLow) + toLow;
  }
  $(document).ready(function() {
    var $body = $("body");
    var $canvas = $("canvas");
    var $output = $("output");
    var context = $canvas[0].getContext("2d");
    var socket = io.connect("http://127.0.0.1:8080");
    var x = 0;
    var y = 0;

    context.fillStyle = "rgb(0, 0, 0)";
    context.lineWidth = 2;

    socket.on("change", function(data) {
      var nX = x;
      var nY = y;

      if (data.x > 77 && data.x < 950) {
        nX = scale(data.x, 77, 950, 800, 0) | 0;
      }

      if (data.y > 110 && data.y < 912) {
        nY = scale(data.y, 912, 110, 0, 600) | 0;
      }

      $output.text(x + ", " + y);
      context.beginPath();

      context.moveTo(x, y);
      context.lineTo(nX, nY);
      context.stroke();

      // context.moveTo();
      // context.arcTo(nX, nY, x, y, 5);
      // context.closePath();
      // context.fill();

      x = nX;
      y = nY;
    });
  });
  </script>
</body>
</html>
